Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id D161867F1A
	for <lists+linux-kernel@lfdr.de>; Sun, 14 Jul 2019 15:23:32 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1728424AbfGNNXa (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Sun, 14 Jul 2019 09:23:30 -0400
Received: from mail-ot1-f66.google.com ([209.85.210.66]:34241 "EHLO
        mail-ot1-f66.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1728316AbfGNNX3 (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Sun, 14 Jul 2019 09:23:29 -0400
Received: by mail-ot1-f66.google.com with SMTP id n5so14166118otk.1;
        Sun, 14 Jul 2019 06:23:29 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:mime-version:references:in-reply-to:from:date
         :message-id:subject:to:cc;
        bh=ZSnuIbnL9robRqYPslX/WkILKl8Emm0qTv8sVRwQJNo=;
        b=mbYaOKeZdsAkOYwhbkmny5LfqQGVwFNKfSmYrpi27BJmFhwNWYg1MV8GY4LTbNPAxa
         x6fdvguEs43z1UL3/mwSYma41zhMLKBT2Nzj9ZQk0Pq5EluZ7eX+HU0CrOrDlhdRsL5q
         nD44cBEAXPZtcNKvGwYsbZXW4UxKjtHsslI6nujKdDFveuJUIy3/A0DFbCl5JOzyfrH7
         PhcdMb71uIqMAEeVitZvGrS8ZTEQJ3GeNgEJXpIRKAN/8iZi9BV8Ig8VteULl4yh3hPC
         FSSY8vgyK5DQO+Vdi6ru+ToHTLIqNPltliLit2DaqLYW+ECbwNvyHW6DFiqwRx8p5vgw
         I8Uw==
X-Gm-Message-State: APjAAAXxOpVu9zC7SlxUBk/1bqJTJXoUaXGvljZmCedAzjxiggB5T3ne
        KKqmlVKfV1YLh1KG8CBVBUU88uF8+y7BpjuPLO4=
X-Google-Smtp-Source: APXvYqwFx+Jrzpgx7oPlw1HEwo5L2RSfdH21hnvMQghrJjMCltBpiONvTQkyb7pVY7ForFo8gLplR1da0iQNXieayHg=
X-Received: by 2002:a9d:7a90:: with SMTP id l16mr16547981otn.297.1563110608697;
 Sun, 14 Jul 2019 06:23:28 -0700 (PDT)
MIME-Version: 1.0
References: <c5713aa4-d290-0f7d-7de8-82bcdf74ee95@web.de> <alpine.LNX.2.21.1907060951060.67@nippy.intranet>
In-Reply-To: <alpine.LNX.2.21.1907060951060.67@nippy.intranet>
From:   Geert Uytterhoeven <geert@linux-m68k.org>
Date:   Sun, 14 Jul 2019 15:23:17 +0200
Message-ID: <CAMuHMdWd31ch+eSje4ww=_JFSZgnxRAUAvS0TCHXq0nzLeVfgg@mail.gmail.com>
Subject: Re: [PATCH] m68k: One function call less in cf_tlb_miss()
To:     Markus Elfring <Markus.Elfring@web.de>
Cc:     Finn Thain <fthain@telegraphics.com.au>,
        Andrew Morton <akpm@linux-foundation.org>,
        Greg Ungerer <gerg@linux-m68k.org>,
        Michal Hocko <mhocko@suse.com>,
        Mike Rapoport <rppt@linux.ibm.com>,
        linux-m68k <linux-m68k@lists.linux-m68k.org>,
        LKML <linux-kernel@vger.kernel.org>,
        kernel-janitors@vger.kernel.org
Content-Type: text/plain; charset="UTF-8"
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

Hi Markus,

On Sat, Jul 6, 2019 at 1:57 AM Finn Thain <fthain@telegraphics.com.au> wrote:
> On Fri, 5 Jul 2019, Markus Elfring wrote:
> > From: Markus Elfring <elfring@users.sourceforge.net>
> > Date: Fri, 5 Jul 2019 17:11:37 +0200
> >
> > Avoid an extra function call
> > by using a ternary operator instead of a conditional statement for a
> > setting selection.

Have you looked at the actual assembler output generated by the compiler?

> > This issue was detected by using the Coccinelle software.
> >
> > Signed-off-by: Markus Elfring <elfring@users.sourceforge.net>
> > ---
> >  arch/m68k/mm/mcfmmu.c | 10 ++++------
> >  1 file changed, 4 insertions(+), 6 deletions(-)
> >
> > diff --git a/arch/m68k/mm/mcfmmu.c b/arch/m68k/mm/mcfmmu.c
> > index 6cb1e41d58d0..02fc0778028e 100644
> > --- a/arch/m68k/mm/mcfmmu.c
> > +++ b/arch/m68k/mm/mcfmmu.c
> > @@ -146,12 +146,10 @@ int cf_tlb_miss(struct pt_regs *regs, int write, int dtlb, int extension_word)
> >
> >       mmu_write(MMUDR, (pte_val(*pte) & PAGE_MASK) |
> >               ((pte->pte) & CF_PAGE_MMUDR_MASK) | MMUDR_SZ_8KB | MMUDR_X);
> > -
> > -     if (dtlb)
> > -             mmu_write(MMUOR, MMUOR_ACC | MMUOR_UAA);
> > -     else
> > -             mmu_write(MMUOR, MMUOR_ITLB | MMUOR_ACC | MMUOR_UAA);
> > -
> > +     mmu_write(MMUOR,
> > +               dtlb
> > +               ? MMUOR_ACC | MMUOR_UAA
> > +               : MMUOR_ITLB | MMUOR_ACC | MMUOR_UAA);

While the ternary operator can be useful for short expressions, it can
also lead to hard-to-read code.  IMHO the latter is the case here
(hint: the expression needs 3 lines).

> If you are trying to avoid redundancy, why not finish the job?
>
> +     mmu_write(MMUOR, (dtlb ? 0 : MMUOR_ITLB) | MMUOR_ACC | MMUOR_UAA);

Thanks Finn, much better!

Gr{oetje,eeting}s,

                        Geert

-- 
Geert Uytterhoeven -- There's lots of Linux beyond ia32 -- geert@linux-m68k.org

In personal conversations with technical people, I call myself a hacker. But
when I'm talking to journalists I just say "programmer" or something like that.
                                -- Linus Torvalds
