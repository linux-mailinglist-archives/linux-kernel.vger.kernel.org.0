Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id 740801A313
	for <lists+linux-kernel@lfdr.de>; Fri, 10 May 2019 20:41:58 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1727921AbfEJSlw (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Fri, 10 May 2019 14:41:52 -0400
Received: from foss.arm.com ([217.140.101.70]:55274 "EHLO foss.arm.com"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1727779AbfEJSlw (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
        Fri, 10 May 2019 14:41:52 -0400
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.72.51.249])
        by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id F08BD374;
        Fri, 10 May 2019 11:41:51 -0700 (PDT)
Received: from big-swifty.misterjones.org (usa-sjc-mx-foss1.foss.arm.com [217.140.101.70])
        by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id DBEF03F6C4;
        Fri, 10 May 2019 11:41:50 -0700 (PDT)
Date:   Fri, 10 May 2019 19:41:40 +0100
Message-ID: <86mujucftn.wl-marc.zyngier@arm.com>
From:   Marc Zyngier <marc.zyngier@arm.com>
To:     Heyi Guo <guoheyi@huawei.com>
Cc:     <linux-kernel@vger.kernel.org>,
        Christoffer Dall <christoffer.dall@arm.com>,
        wanghaibin 00208455 <wanghaibin.wang@huawei.com>
Subject: Re: Does it make sense to flush ap_list of offlined vcpu?
In-Reply-To: <73927ccf-1582-2e91-051b-b22854df3290@huawei.com>
References: <73927ccf-1582-2e91-051b-b22854df3290@huawei.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 EasyPG/1.0.0 Emacs/26
 (aarch64-unknown-linux-gnu) MULE/6.0 (HANACHIRUSATO)
Organization: ARM Ltd
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Thu, 09 May 2019 16:26:04 +0100,
Heyi Guo <guoheyi@huawei.com> wrote:
> 
> Hi folks,
> 
> When guest OS calls PSCI CPU_OFF, the corresponding VCPU will be put
> in sleep state. But if there is still IRQ remaining in this VCPU's
> ap_list, this will block all the following triggers of this IRQ even
> to other VCPUs. Does it make sense to flush the ap_list of the VCPU
> when it is requested to be offlined? Or did I miss something?

I can't see a good reason to do so: If a vcpu gets offlined, the guest
OS has to move interrupt routed to that vcpu to another one. There is
nothing in the GIC architecture that the interrupt will be moved to
another vcpu (well, it could be done with 1:N, which is not really
virtualizable, and not advertised by KVM). That's not different from
what would happen on bare metal.

Thanks,

	M.

-- 
Jazz is not dead, it just smell funny.
