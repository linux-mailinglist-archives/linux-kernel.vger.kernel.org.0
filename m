Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id DBDFFEB13
	for <lists+linux-kernel@lfdr.de>; Mon, 29 Apr 2019 21:47:24 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1729185AbfD2TrR (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Mon, 29 Apr 2019 15:47:17 -0400
Received: from mx2.suse.de ([195.135.220.15]:36144 "EHLO mx1.suse.de"
        rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org with ESMTP
        id S1729113AbfD2TrR (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
        Mon, 29 Apr 2019 15:47:17 -0400
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
        by mx1.suse.de (Postfix) with ESMTP id 46E76ADDB;
        Mon, 29 Apr 2019 19:47:16 +0000 (UTC)
Date:   Mon, 29 Apr 2019 21:47:15 +0200
Message-ID: <s5hy33siofw.wl-tiwai@suse.de>
From:   Takashi Iwai <tiwai@suse.de>
To:     Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Cc:     Mika Westerberg <mika.westerberg@linux.intel.com>,
        Bjorn Helgaas <bhelgaas@google.com>,
        Lukas Wunner <lukas@wunner.de>, Jiri Slaby <jslaby@suse.cz>,
        Michael Hirmke <opensuse@mike.franken.de>,
        linux-kernel@vger.kernel.org
Subject: [REGRESSION 5.0.8] Dell thunderbolt dock broken (xhci_hcd and thunderbolt)
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

Hi,

we've got a regression report wrt xhci_hcd and thunderbolt on a Dell
machine.  5.0.7 is confirmed to work, so it must be a regression
introduced by 5.0.8.

The details are found in openSUSE Bugzilla entry:
  https://bugzilla.opensuse.org/show_bug.cgi?id=1132943

The probe of xhci_hcd on the dock fails like:
[    6.269062] pcieport 0000:3a:00.0: enabling device (0006 -> 0007)
[    6.270027] pcieport 0000:3b:03.0: enabling device (0006 -> 0007)
[    6.270758] xhci_hcd 0000:3c:00.0: init 0000:3c:00.0 fail, -16
[    6.270764] xhci_hcd: probe of 0000:3c:00.0 failed with error -16
[    6.271002] xhci_hcd 0000:3d:00.0: init 0000:3d:00.0 fail, -16

and later on, thunderbolt gives warnings:
[   30.232676] thunderbolt 0000:05:00.0: unexpected hop count: 1023
[   30.232957] ------------[ cut here ]------------
[   30.232958] thunderbolt 0000:05:00.0: interrupt for TX ring 0 is already enabled
[   30.232974] WARNING: CPU: 3 PID: 1009 at drivers/thunderbolt/nhi.c:107 ring_interrupt_active+0x1ea/0x230 [thunderbolt]


I blindly suspected the commit 3943af9d01e9 and asked for a reverted
kernel, but in vain.  And now it was confirmed that the problem is
present with the latest 5.1-rc, too.

I put some people who might have interest and the reporter (Michael)
to Cc.  If anyone has an idea, feel free to join to the Bugzilla, or
let me know if any help needed from the distro side.


Thanks!

Takashi
