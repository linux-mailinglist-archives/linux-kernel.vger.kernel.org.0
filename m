Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id 654EC36D16
	for <lists+linux-kernel@lfdr.de>; Thu,  6 Jun 2019 09:10:38 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726855AbfFFHKc (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Thu, 6 Jun 2019 03:10:32 -0400
Received: from foss.arm.com ([217.140.101.70]:41596 "EHLO foss.arm.com"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1725782AbfFFHKb (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
        Thu, 6 Jun 2019 03:10:31 -0400
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.72.51.249])
        by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id 39C98374;
        Thu,  6 Jun 2019 00:10:31 -0700 (PDT)
Received: from big-swifty.misterjones.org (usa-sjc-mx-foss1.foss.arm.com [217.140.101.70])
        by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id 13ADB3F246;
        Thu,  6 Jun 2019 00:10:25 -0700 (PDT)
Date:   Thu, 06 Jun 2019 08:10:24 +0100
Message-ID: <86o93bgpen.wl-marc.zyngier@arm.com>
From:   Marc Zyngier <marc.zyngier@arm.com>
To:     Benjamin Herrenschmidt <benh@kernel.crashing.org>
Cc:     Talel Shenhar <talel@amazon.com>, <nicolas.ferre@microchip.com>,
        <jason@lakedaemon.net>, <mark.rutland@arm.com>,
        <mchehab+samsung@kernel.org>, <robh+dt@kernel.org>,
        <davem@davemloft.net>, <shawn.lin@rock-chips.com>,
        <tglx@linutronix.de>, <devicetree@vger.kernel.org>,
        <gregkh@linuxfoundation.org>, <linux-kernel@vger.kernel.org>,
        <dwmw@amazon.co.uk>, <jonnyc@amazon.com>, <hhhawa@amazon.com>,
        <ronenk@amazon.com>, <hanochu@amazon.com>, <barakw@amazon.com>
Subject: Re: [PATCH v2 2/2] irqchip: al-fic: Introduce Amazon's Annapurna Labs Fabric Interrupt Controller Driver
In-Reply-To: <8930de04d7f40b84068e4478a12fc496d53930c9.camel@kernel.crashing.org>
References: <1559731921-14023-1-git-send-email-talel@amazon.com>
        <1559731921-14023-3-git-send-email-talel@amazon.com>
        <fa6e5a95-d9dd-19f6-43e3-3046e0898bda@arm.com>
        <8930de04d7f40b84068e4478a12fc496d53930c9.camel@kernel.crashing.org>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 EasyPG/1.0.0 Emacs/26
 (aarch64-unknown-linux-gnu) MULE/6.0 (HANACHIRUSATO)
Organization: ARM Ltd
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Wed, 05 Jun 2019 23:02:13 +0100,
Benjamin Herrenschmidt <benh@kernel.crashing.org> wrote:
> 
> On Wed, 2019-06-05 at 13:22 +0100, Marc Zyngier wrote:
> > 
> > > +	 * This is generally fixed depending on what pieces of HW it's wired up
> > > +	 * to.
> > > +	 *
> > > +	 * We configure it based on the sensitivity of the first source
> > > +	 * being setup, and reject any subsequent attempt at configuring it in a
> > > +	 * different way.
> > 
> > Is that a reliable guess? It also strikes me that the DT binding doesn't
> > allow for the trigger type to be passed, meaning the individual drivers
> > have to request the trigger as part of their request_irq() call. I'd
> > rather you have a complete interrupt specifier in DT, and document the
> > various limitations of the HW.
> 
> Actually the DT does, but Talel forgot to update the "example" part of
> the binding patch. The description does say 2 cells.

Yeah, I missed that and only read the example.

> This is the best approach imho (translation: I asked Talel to do it
> this way :-) The other option which I don't like is to stick to
> #interrupt-cells = 1, and have a separate property in the interrupt
> controller node to indicate whether it needs to be configured as level
> or edge.

Right, that's what I was suggesting in a separate email.

> These FICs are used for what is generally fixed wires inside the SoC,
> so it doesn't matter much either way, but I prefer having it self
> configured based on source just in case a future implementation doesn't
> have the limitation of all inputs having the same trigger type.

Fair enough. But it should be pretty easy to verify statically that
all interrupt specifiers targeting this interrupt controller have a
similar type.

RobH, is that something the yaml thing could do for us?

Thanks,

	M.

-- 
Jazz is not dead, it just smells funny.
