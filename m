Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id CB19B117F56
	for <lists+linux-kernel@lfdr.de>; Tue, 10 Dec 2019 06:05:43 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1727149AbfLJFFm (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Tue, 10 Dec 2019 00:05:42 -0500
Received: from mailgw01.mediatek.com ([210.61.82.183]:57030 "EHLO
        mailgw01.mediatek.com" rhost-flags-OK-FAIL-OK-FAIL) by vger.kernel.org
        with ESMTP id S1726971AbfLJFFk (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Tue, 10 Dec 2019 00:05:40 -0500
X-UUID: c318433ed47b49988ddaf10e6c69dd06-20191210
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed; d=mediatek.com; s=dk;
        h=Content-Transfer-Encoding:Content-Type:MIME-Version:References:In-Reply-To:Message-ID:Date:Subject:CC:To:From; bh=vLJdxaH2MWrmzj2S/id6q7QDiTMGmRbVBP51VcvkaCA=;
        b=o2nFEYSlnBSV5LlvmLCp1wkJGowY/QwmAYRKzwALnRH2yoorCI6LBy4eV9k6h4+G2pQBj3dLq+Gn/NtpFuH23QkVgntKXPSxxelvvakjUFpQKCbszAq6dU+elVePAE55FHCZZpEYDnbt2AbyCGWuV+HaHs+5g8vk+LL3bRZphNg=;
X-UUID: c318433ed47b49988ddaf10e6c69dd06-20191210
Received: from mtkcas08.mediatek.inc [(172.21.101.126)] by mailgw01.mediatek.com
        (envelope-from <bibby.hsieh@mediatek.com>)
        (Cellopoint E-mail Firewall v4.1.10 Build 0809 with TLS)
        with ESMTP id 740814321; Tue, 10 Dec 2019 13:05:30 +0800
Received: from mtkcas09.mediatek.inc (172.21.101.178) by
 mtkmbs08n2.mediatek.inc (172.21.101.56) with Microsoft SMTP Server (TLS) id
 15.0.1395.4; Tue, 10 Dec 2019 13:04:32 +0800
Received: from mtksdccf07.mediatek.inc (172.21.84.99) by mtkcas09.mediatek.inc
 (172.21.101.73) with Microsoft SMTP Server id 15.0.1395.4 via Frontend
 Transport; Tue, 10 Dec 2019 13:05:22 +0800
From:   Bibby Hsieh <bibby.hsieh@mediatek.com>
To:     David Airlie <airlied@linux.ie>,
        Matthias Brugger <matthias.bgg@gmail.com>,
        Daniel Vetter <daniel.vetter@ffwll.ch>,
        <dri-devel@lists.freedesktop.org>,
        <linux-mediatek@lists.infradead.org>
CC:     Philipp Zabel <p.zabel@pengutronix.de>,
        YT Shen <yt.shen@mediatek.com>,
        Thierry Reding <thierry.reding@gmail.com>,
        CK Hu <ck.hu@mediatek.com>,
        <linux-arm-kernel@lists.infradead.org>, <tfiga@chromium.org>,
        <drinkcat@chromium.org>, <linux-kernel@vger.kernel.org>,
        <srv_heupstream@mediatek.com>,
        Bibby Hsieh <bibby.hsieh@mediatek.com>
Subject: [PATCH v5 3/7] drm/mediatek: update cursors by using async atomic update
Date:   Tue, 10 Dec 2019 13:05:22 +0800
Message-ID: <20191210050526.4437-4-bibby.hsieh@mediatek.com>
X-Mailer: git-send-email 2.18.0
In-Reply-To: <20191210050526.4437-1-bibby.hsieh@mediatek.com>
References: <20191210050526.4437-1-bibby.hsieh@mediatek.com>
MIME-Version: 1.0
Content-Type: text/plain
X-TM-SNTS-SMTP: 25289DC1C7CD5B2C4C889A1F72A6B1AA536FCC2607E5A6F6A90018A918158CB82000:8
X-MTK:  N
Content-Transfer-Encoding: base64
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

U3VwcG9ydCB0byBhc3luYyB1cGRhdGVzIG9mIGN1cnNvcnMgYnkgdXNpbmcgdGhlIG5ldyBhdG9t
aWMNCmludGVyZmFjZSBmb3IgdGhhdC4NCg0KU2lnbmVkLW9mZi1ieTogQmliYnkgSHNpZWggPGJp
YmJ5LmhzaWVoQG1lZGlhdGVrLmNvbT4NClJldmlld2VkLWJ5OiBDSyBIdSA8Y2suaHVAbWVkaWF0
ZWsuY29tPg0KLS0tDQogZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1fY3J0Yy5jICB8
IDk4ICsrKysrKysrKysrKysrKysrKystLS0tLQ0KIGRyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9t
dGtfZHJtX2NydGMuaCAgfCAgMiArDQogZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1f
cGxhbmUuYyB8IDQ3ICsrKysrKysrKysrKw0KIGRyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtf
ZHJtX3BsYW5lLmggfCAgMiArDQogNCBmaWxlcyBjaGFuZ2VkLCAxMjggaW5zZXJ0aW9ucygrKSwg
MjEgZGVsZXRpb25zKC0pDQoNCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsv
bXRrX2RybV9jcnRjLmMgYi9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9jcnRjLmMN
CmluZGV4IGFmMDk3YjdkYjcyZi4uYjc3MWVlMDU5NjhiIDEwMDY0NA0KLS0tIGEvZHJpdmVycy9n
cHUvZHJtL21lZGlhdGVrL210a19kcm1fY3J0Yy5jDQorKysgYi9kcml2ZXJzL2dwdS9kcm0vbWVk
aWF0ZWsvbXRrX2RybV9jcnRjLmMNCkBAIC00MSwxMiArNDEsMTYgQEAgc3RydWN0IG10a19kcm1f
Y3J0YyB7DQogCXN0cnVjdCBkcm1fcGxhbmUJCSpwbGFuZXM7DQogCXVuc2lnbmVkIGludAkJCWxh
eWVyX25yOw0KIAlib29sCQkJCXBlbmRpbmdfcGxhbmVzOw0KKwlib29sCQkJCXBlbmRpbmdfYXN5
bmNfcGxhbmVzOw0KIA0KIAl2b2lkIF9faW9tZW0JCQkqY29uZmlnX3JlZ3M7DQogCWNvbnN0IHN0
cnVjdCBtdGtfbW1zeXNfcmVnX2RhdGEgKm1tc3lzX3JlZ19kYXRhOw0KIAlzdHJ1Y3QgbXRrX2Rp
c3BfbXV0ZXgJCSptdXRleDsNCiAJdW5zaWduZWQgaW50CQkJZGRwX2NvbXBfbnI7DQogCXN0cnVj
dCBtdGtfZGRwX2NvbXAJCSoqZGRwX2NvbXA7DQorDQorCS8qIGxvY2sgZm9yIGRpc3BsYXkgaGFy
ZHdhcmUgYWNjZXNzICovDQorCXN0cnVjdCBtdXRleAkJCWh3X2xvY2s7DQogfTsNCiANCiBzdHJ1
Y3QgbXRrX2NydGNfc3RhdGUgew0KQEAgLTQxMiw2ICs0MTYsNjMgQEAgc3RhdGljIHZvaWQgbXRr
X2NydGNfZGRwX2NvbmZpZyhzdHJ1Y3QgZHJtX2NydGMgKmNydGMpDQogCQl9DQogCQltdGtfY3J0
Yy0+cGVuZGluZ19wbGFuZXMgPSBmYWxzZTsNCiAJfQ0KKw0KKwlpZiAobXRrX2NydGMtPnBlbmRp
bmdfYXN5bmNfcGxhbmVzKSB7DQorCQlmb3IgKGkgPSAwOyBpIDwgbXRrX2NydGMtPmxheWVyX25y
OyBpKyspIHsNCisJCQlzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSA9ICZtdGtfY3J0Yy0+cGxhbmVz
W2ldOw0KKwkJCXN0cnVjdCBtdGtfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlOw0KKw0KKwkJCXBs
YW5lX3N0YXRlID0gdG9fbXRrX3BsYW5lX3N0YXRlKHBsYW5lLT5zdGF0ZSk7DQorDQorCQkJaWYg
KCFwbGFuZV9zdGF0ZS0+cGVuZGluZy5hc3luY19jb25maWcpDQorCQkJCWNvbnRpbnVlOw0KKw0K
KwkJCWNvbXAgPSBtdGtfZHJtX2RkcF9jb21wX2Zvcl9wbGFuZShjcnRjLCBwbGFuZSwNCisJCQkJ
CQkJICAmbG9jYWxfbGF5ZXIpOw0KKw0KKwkJCWlmIChjb21wKQ0KKwkJCQltdGtfZGRwX2NvbXBf
bGF5ZXJfY29uZmlnKGNvbXAsIGxvY2FsX2xheWVyLA0KKwkJCQkJCQkgIHBsYW5lX3N0YXRlKTsN
CisJCQlwbGFuZV9zdGF0ZS0+cGVuZGluZy5hc3luY19jb25maWcgPSBmYWxzZTsNCisJCX0NCisJ
CW10a19jcnRjLT5wZW5kaW5nX2FzeW5jX3BsYW5lcyA9IGZhbHNlOw0KKwl9DQorfQ0KKw0KK3N0
YXRpYyB2b2lkIG10a19kcm1fY3J0Y19od19jb25maWcoc3RydWN0IG10a19kcm1fY3J0YyAqbXRr
X2NydGMpDQorew0KKwlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSAmbXRrX2NydGMtPmJhc2U7DQor
CXN0cnVjdCBtdGtfZHJtX3ByaXZhdGUgKnByaXYgPSBjcnRjLT5kZXYtPmRldl9wcml2YXRlOw0K
Kwl1bnNpZ25lZCBpbnQgcGVuZGluZ19wbGFuZXMgPSAwLCBwZW5kaW5nX2FzeW5jX3BsYW5lcyA9
IDA7DQorCWludCBpOw0KKw0KKwltdXRleF9sb2NrKCZtdGtfY3J0Yy0+aHdfbG9jayk7DQorCWZv
ciAoaSA9IDA7IGkgPCBtdGtfY3J0Yy0+bGF5ZXJfbnI7IGkrKykgew0KKwkJc3RydWN0IGRybV9w
bGFuZSAqcGxhbmUgPSAmbXRrX2NydGMtPnBsYW5lc1tpXTsNCisJCXN0cnVjdCBtdGtfcGxhbmVf
c3RhdGUgKnBsYW5lX3N0YXRlOw0KKw0KKwkJcGxhbmVfc3RhdGUgPSB0b19tdGtfcGxhbmVfc3Rh
dGUocGxhbmUtPnN0YXRlKTsNCisJCWlmIChwbGFuZV9zdGF0ZS0+cGVuZGluZy5kaXJ0eSkgew0K
KwkJCXBsYW5lX3N0YXRlLT5wZW5kaW5nLmNvbmZpZyA9IHRydWU7DQorCQkJcGxhbmVfc3RhdGUt
PnBlbmRpbmcuZGlydHkgPSBmYWxzZTsNCisJCQlwZW5kaW5nX3BsYW5lcyB8PSBCSVQoaSk7DQor
CQl9IGVsc2UgaWYgKHBsYW5lX3N0YXRlLT5wZW5kaW5nLmFzeW5jX2RpcnR5KSB7DQorCQkJcGxh
bmVfc3RhdGUtPnBlbmRpbmcuYXN5bmNfY29uZmlnID0gdHJ1ZTsNCisJCQlwbGFuZV9zdGF0ZS0+
cGVuZGluZy5hc3luY19kaXJ0eSA9IGZhbHNlOw0KKwkJCXBlbmRpbmdfYXN5bmNfcGxhbmVzIHw9
IEJJVChpKTsNCisJCX0NCisJfQ0KKwlpZiAocGVuZGluZ19wbGFuZXMpDQorCQltdGtfY3J0Yy0+
cGVuZGluZ19wbGFuZXMgPSB0cnVlOw0KKwlpZiAocGVuZGluZ19hc3luY19wbGFuZXMpDQorCQlt
dGtfY3J0Yy0+cGVuZGluZ19hc3luY19wbGFuZXMgPSB0cnVlOw0KKw0KKwlpZiAocHJpdi0+ZGF0
YS0+c2hhZG93X3JlZ2lzdGVyKSB7DQorCQltdGtfZGlzcF9tdXRleF9hY3F1aXJlKG10a19jcnRj
LT5tdXRleCk7DQorCQltdGtfY3J0Y19kZHBfY29uZmlnKGNydGMpOw0KKwkJbXRrX2Rpc3BfbXV0
ZXhfcmVsZWFzZShtdGtfY3J0Yy0+bXV0ZXgpOw0KKwl9DQorCW11dGV4X3VubG9jaygmbXRrX2Ny
dGMtPmh3X2xvY2spOw0KIH0NCiANCiBpbnQgbXRrX2RybV9jcnRjX3BsYW5lX2NoZWNrKHN0cnVj
dCBkcm1fY3J0YyAqY3J0Yywgc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsDQpAQCAtNDI2LDYgKzQ4
NywyMCBAQCBpbnQgbXRrX2RybV9jcnRjX3BsYW5lX2NoZWNrKHN0cnVjdCBkcm1fY3J0YyAqY3J0
Yywgc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsDQogCXJldHVybiAwOw0KIH0NCiANCit2b2lkIG10
a19kcm1fY3J0Y19hc3luY191cGRhdGUoc3RydWN0IGRybV9jcnRjICpjcnRjLCBzdHJ1Y3QgZHJt
X3BsYW5lICpwbGFuZSwNCisJCQkgICAgICAgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqbmV3X3N0
YXRlKQ0KK3sNCisJc3RydWN0IG10a19kcm1fY3J0YyAqbXRrX2NydGMgPSB0b19tdGtfY3J0Yyhj
cnRjKTsNCisJY29uc3Qgc3RydWN0IGRybV9wbGFuZV9oZWxwZXJfZnVuY3MgKnBsYW5lX2hlbHBl
cl9mdW5jcyA9DQorCQkJcGxhbmUtPmhlbHBlcl9wcml2YXRlOw0KKw0KKwlpZiAoIW10a19jcnRj
LT5lbmFibGVkKQ0KKwkJcmV0dXJuOw0KKw0KKwlwbGFuZV9oZWxwZXJfZnVuY3MtPmF0b21pY191
cGRhdGUocGxhbmUsIG5ld19zdGF0ZSk7DQorCW10a19kcm1fY3J0Y19od19jb25maWcobXRrX2Ny
dGMpOw0KK30NCisNCiBzdGF0aWMgdm9pZCBtdGtfZHJtX2NydGNfYXRvbWljX2VuYWJsZShzdHJ1
Y3QgZHJtX2NydGMgKmNydGMsDQogCQkJCSAgICAgICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm9s
ZF9zdGF0ZSkNCiB7DQpAQCAtNTA3LDM0ICs1ODIsMTQgQEAgc3RhdGljIHZvaWQgbXRrX2RybV9j
cnRjX2F0b21pY19mbHVzaChzdHJ1Y3QgZHJtX2NydGMgKmNydGMsDQogCQkJCSAgICAgIHN0cnVj
dCBkcm1fY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUpDQogew0KIAlzdHJ1Y3QgbXRrX2RybV9j
cnRjICptdGtfY3J0YyA9IHRvX210a19jcnRjKGNydGMpOw0KLQlzdHJ1Y3QgbXRrX2RybV9wcml2
YXRlICpwcml2ID0gY3J0Yy0+ZGV2LT5kZXZfcHJpdmF0ZTsNCi0JdW5zaWduZWQgaW50IHBlbmRp
bmdfcGxhbmVzID0gMDsNCiAJaW50IGk7DQogDQogCWlmIChtdGtfY3J0Yy0+ZXZlbnQpDQogCQlt
dGtfY3J0Yy0+cGVuZGluZ19uZWVkc192YmxhbmsgPSB0cnVlOw0KLQlmb3IgKGkgPSAwOyBpIDwg
bXRrX2NydGMtPmxheWVyX25yOyBpKyspIHsNCi0JCXN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lID0g
Jm10a19jcnRjLT5wbGFuZXNbaV07DQotCQlzdHJ1Y3QgbXRrX3BsYW5lX3N0YXRlICpwbGFuZV9z
dGF0ZTsNCi0NCi0JCXBsYW5lX3N0YXRlID0gdG9fbXRrX3BsYW5lX3N0YXRlKHBsYW5lLT5zdGF0
ZSk7DQotCQlpZiAocGxhbmVfc3RhdGUtPnBlbmRpbmcuZGlydHkpIHsNCi0JCQlwbGFuZV9zdGF0
ZS0+cGVuZGluZy5jb25maWcgPSB0cnVlOw0KLQkJCXBsYW5lX3N0YXRlLT5wZW5kaW5nLmRpcnR5
ID0gZmFsc2U7DQotCQkJcGVuZGluZ19wbGFuZXMgfD0gQklUKGkpOw0KLQkJfQ0KLQl9DQotCWlm
IChwZW5kaW5nX3BsYW5lcykNCi0JCW10a19jcnRjLT5wZW5kaW5nX3BsYW5lcyA9IHRydWU7DQog
CWlmIChjcnRjLT5zdGF0ZS0+Y29sb3JfbWdtdF9jaGFuZ2VkKQ0KIAkJZm9yIChpID0gMDsgaSA8
IG10a19jcnRjLT5kZHBfY29tcF9ucjsgaSsrKQ0KIAkJCW10a19kZHBfZ2FtbWFfc2V0KG10a19j
cnRjLT5kZHBfY29tcFtpXSwgY3J0Yy0+c3RhdGUpOw0KLQ0KLQlpZiAocHJpdi0+ZGF0YS0+c2hh
ZG93X3JlZ2lzdGVyKSB7DQotCQltdGtfZGlzcF9tdXRleF9hY3F1aXJlKG10a19jcnRjLT5tdXRl
eCk7DQotCQltdGtfY3J0Y19kZHBfY29uZmlnKGNydGMpOw0KLQkJbXRrX2Rpc3BfbXV0ZXhfcmVs
ZWFzZShtdGtfY3J0Yy0+bXV0ZXgpOw0KLQl9DQorCW10a19kcm1fY3J0Y19od19jb25maWcobXRr
X2NydGMpOw0KIH0NCiANCiBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9jcnRjX2Z1bmNzIG10a19j
cnRjX2Z1bmNzID0gew0KQEAgLTcyNiw2ICs3ODEsNyBAQCBpbnQgbXRrX2RybV9jcnRjX2NyZWF0
ZShzdHJ1Y3QgZHJtX2RldmljZSAqZHJtX2RldiwNCiAJZHJtX21vZGVfY3J0Y19zZXRfZ2FtbWFf
c2l6ZSgmbXRrX2NydGMtPmJhc2UsIE1US19MVVRfU0laRSk7DQogCWRybV9jcnRjX2VuYWJsZV9j
b2xvcl9tZ210KCZtdGtfY3J0Yy0+YmFzZSwgMCwgZmFsc2UsIE1US19MVVRfU0laRSk7DQogCXBy
aXYtPm51bV9waXBlcysrOw0KKwltdXRleF9pbml0KCZtdGtfY3J0Yy0+aHdfbG9jayk7DQogDQog
CXJldHVybiAwOw0KIH0NCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRr
X2RybV9jcnRjLmggYi9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9jcnRjLmgNCmlu
ZGV4IDZhZmUxYzE5NTU3YS4uYTJiNDY3N2E0NTFjIDEwMDY0NA0KLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL21lZGlhdGVrL210a19kcm1fY3J0Yy5oDQorKysgYi9kcml2ZXJzL2dwdS9kcm0vbWVkaWF0
ZWsvbXRrX2RybV9jcnRjLmgNCkBAIC0yMSw1ICsyMSw3IEBAIGludCBtdGtfZHJtX2NydGNfY3Jl
YXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkcm1fZGV2LA0KIAkJCXVuc2lnbmVkIGludCBwYXRoX2xl
bik7DQogaW50IG10a19kcm1fY3J0Y19wbGFuZV9jaGVjayhzdHJ1Y3QgZHJtX2NydGMgKmNydGMs
IHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLA0KIAkJCSAgICAgc3RydWN0IG10a19wbGFuZV9zdGF0
ZSAqc3RhdGUpOw0KK3ZvaWQgbXRrX2RybV9jcnRjX2FzeW5jX3VwZGF0ZShzdHJ1Y3QgZHJtX2Ny
dGMgKmNydGMsIHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLA0KKwkJCSAgICAgICBzdHJ1Y3QgZHJt
X3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSk7DQogDQogI2VuZGlmIC8qIE1US19EUk1fQ1JUQ19I
ICovDQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1fcGxhbmUu
YyBiL2RyaXZlcnMvZ3B1L2RybS9tZWRpYXRlay9tdGtfZHJtX3BsYW5lLmMNCmluZGV4IDNiMGNj
OTFjNzAyMy4uMTg5NzQ0ZDM0ZjUzIDEwMDY0NA0KLS0tIGEvZHJpdmVycy9ncHUvZHJtL21lZGlh
dGVrL210a19kcm1fcGxhbmUuYw0KKysrIGIvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19k
cm1fcGxhbmUuYw0KQEAgLTcsNiArNyw3IEBADQogI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljLmg+
DQogI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljX2hlbHBlci5oPg0KICNpbmNsdWRlIDxkcm0vZHJt
X2ZvdXJjYy5oPg0KKyNpbmNsdWRlIDxkcm0vZHJtX2F0b21pY191YXBpLmg+DQogI2luY2x1ZGUg
PGRybS9kcm1fcGxhbmVfaGVscGVyLmg+DQogI2luY2x1ZGUgPGRybS9kcm1fZ2VtX2ZyYW1lYnVm
ZmVyX2hlbHBlci5oPg0KIA0KQEAgLTc2LDYgKzc3LDUwIEBAIHN0YXRpYyB2b2lkIG10a19kcm1f
cGxhbmVfZGVzdHJveV9zdGF0ZShzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwNCiAJa2ZyZWUodG9f
bXRrX3BsYW5lX3N0YXRlKHN0YXRlKSk7DQogfQ0KIA0KK3N0YXRpYyBpbnQgbXRrX3BsYW5lX2F0
b21pY19hc3luY19jaGVjayhzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwNCisJCQkJCXN0cnVjdCBk
cm1fcGxhbmVfc3RhdGUgKnN0YXRlKQ0KK3sNCisJc3RydWN0IGRybV9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlOw0KKw0KKwlpZiAocGxhbmUgIT0gc3RhdGUtPmNydGMtPmN1cnNvcikNCisJCXJldHVy
biAtRUlOVkFMOw0KKw0KKwlpZiAoIXBsYW5lLT5zdGF0ZSkNCisJCXJldHVybiAtRUlOVkFMOw0K
Kw0KKwlpZiAoIXBsYW5lLT5zdGF0ZS0+ZmIpDQorCQlyZXR1cm4gLUVJTlZBTDsNCisNCisJaWYg
KHN0YXRlLT5zdGF0ZSkNCisJCWNydGNfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9leGlzdGluZ19j
cnRjX3N0YXRlKHN0YXRlLT5zdGF0ZSwNCisJCQkJCQkJCXN0YXRlLT5jcnRjKTsNCisJZWxzZSAv
KiBTcGVjaWFsIGNhc2UgZm9yIGFzeW5jaHJvbm91cyBjdXJzb3IgdXBkYXRlcy4gKi8NCisJCWNy
dGNfc3RhdGUgPSBzdGF0ZS0+Y3J0Yy0+c3RhdGU7DQorDQorCXJldHVybiBkcm1fYXRvbWljX2hl
bHBlcl9jaGVja19wbGFuZV9zdGF0ZShwbGFuZS0+c3RhdGUsIGNydGNfc3RhdGUsDQorCQkJCQkJ
ICAgRFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FMSU5HLA0KKwkJCQkJCSAgIERSTV9QTEFORV9IRUxQ
RVJfTk9fU0NBTElORywNCisJCQkJCQkgICB0cnVlLCB0cnVlKTsNCit9DQorDQorc3RhdGljIHZv
aWQgbXRrX3BsYW5lX2F0b21pY19hc3luY191cGRhdGUoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUs
DQorCQkJCQkgIHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKm5ld19zdGF0ZSkNCit7DQorCXN0cnVj
dCBtdGtfcGxhbmVfc3RhdGUgKnN0YXRlID0gdG9fbXRrX3BsYW5lX3N0YXRlKHBsYW5lLT5zdGF0
ZSk7DQorDQorCXBsYW5lLT5zdGF0ZS0+Y3J0Y194ID0gbmV3X3N0YXRlLT5jcnRjX3g7DQorCXBs
YW5lLT5zdGF0ZS0+Y3J0Y195ID0gbmV3X3N0YXRlLT5jcnRjX3k7DQorCXBsYW5lLT5zdGF0ZS0+
Y3J0Y19oID0gbmV3X3N0YXRlLT5jcnRjX2g7DQorCXBsYW5lLT5zdGF0ZS0+Y3J0Y193ID0gbmV3
X3N0YXRlLT5jcnRjX3c7DQorCXBsYW5lLT5zdGF0ZS0+c3JjX3ggPSBuZXdfc3RhdGUtPnNyY194
Ow0KKwlwbGFuZS0+c3RhdGUtPnNyY195ID0gbmV3X3N0YXRlLT5zcmNfeTsNCisJcGxhbmUtPnN0
YXRlLT5zcmNfaCA9IG5ld19zdGF0ZS0+c3JjX2g7DQorCXBsYW5lLT5zdGF0ZS0+c3JjX3cgPSBu
ZXdfc3RhdGUtPnNyY193Ow0KKwlzdGF0ZS0+cGVuZGluZy5hc3luY19kaXJ0eSA9IHRydWU7DQor
DQorCW10a19kcm1fY3J0Y19hc3luY191cGRhdGUobmV3X3N0YXRlLT5jcnRjLCBwbGFuZSwgbmV3
X3N0YXRlKTsNCit9DQorDQogc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fcGxhbmVfZnVuY3MgbXRr
X3BsYW5lX2Z1bmNzID0gew0KIAkudXBkYXRlX3BsYW5lID0gZHJtX2F0b21pY19oZWxwZXJfdXBk
YXRlX3BsYW5lLA0KIAkuZGlzYWJsZV9wbGFuZSA9IGRybV9hdG9taWNfaGVscGVyX2Rpc2FibGVf
cGxhbmUsDQpAQCAtMTY0LDYgKzIwOSw4IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX3BsYW5l
X2hlbHBlcl9mdW5jcyBtdGtfcGxhbmVfaGVscGVyX2Z1bmNzID0gew0KIAkuYXRvbWljX2NoZWNr
ID0gbXRrX3BsYW5lX2F0b21pY19jaGVjaywNCiAJLmF0b21pY191cGRhdGUgPSBtdGtfcGxhbmVf
YXRvbWljX3VwZGF0ZSwNCiAJLmF0b21pY19kaXNhYmxlID0gbXRrX3BsYW5lX2F0b21pY19kaXNh
YmxlLA0KKwkuYXRvbWljX2FzeW5jX3VwZGF0ZSA9IG10a19wbGFuZV9hdG9taWNfYXN5bmNfdXBk
YXRlLA0KKwkuYXRvbWljX2FzeW5jX2NoZWNrID0gbXRrX3BsYW5lX2F0b21pY19hc3luY19jaGVj
aywNCiB9Ow0KIA0KIGludCBtdGtfcGxhbmVfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBz
dHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwNCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vbWVk
aWF0ZWsvbXRrX2RybV9wbGFuZS5oIGIvZHJpdmVycy9ncHUvZHJtL21lZGlhdGVrL210a19kcm1f
cGxhbmUuaA0KaW5kZXggNzYwODg1ZTM1YjI3Li5kNDU0YmVjZTk1MzUgMTAwNjQ0DQotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9wbGFuZS5oDQorKysgYi9kcml2ZXJzL2dw
dS9kcm0vbWVkaWF0ZWsvbXRrX2RybV9wbGFuZS5oDQpAQCAtMjIsNiArMjIsOCBAQCBzdHJ1Y3Qg
bXRrX3BsYW5lX3BlbmRpbmdfc3RhdGUgew0KIAl1bnNpZ25lZCBpbnQJCQloZWlnaHQ7DQogCXVu
c2lnbmVkIGludAkJCXJvdGF0aW9uOw0KIAlib29sCQkJCWRpcnR5Ow0KKwlib29sCQkJCWFzeW5j
X2RpcnR5Ow0KKwlib29sCQkJCWFzeW5jX2NvbmZpZzsNCiB9Ow0KIA0KIHN0cnVjdCBtdGtfcGxh
bmVfc3RhdGUgew0KLS0gDQoyLjE4LjANCg==

