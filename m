Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id 43E99130752
	for <lists+linux-kernel@lfdr.de>; Sun,  5 Jan 2020 11:48:36 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1727190AbgAEKrY (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Sun, 5 Jan 2020 05:47:24 -0500
Received: from mailgw01.mediatek.com ([210.61.82.183]:21552 "EHLO
        mailgw01.mediatek.com" rhost-flags-OK-FAIL-OK-FAIL) by vger.kernel.org
        with ESMTP id S1727025AbgAEKrV (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Sun, 5 Jan 2020 05:47:21 -0500
X-UUID: e07b8a8354b04b3db47f5fefc81ef96e-20200105
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed; d=mediatek.com; s=dk;
        h=Content-Transfer-Encoding:Content-Type:MIME-Version:References:In-Reply-To:Message-ID:Date:Subject:CC:To:From; bh=/GRQoslk/LSHOdzw5eAs8KczvypmvSkfZUU+7BeTfag=;
        b=Nav1LSOT1U4hOZPHRAQOPwpEEN0ETiJqv12EqqTUB0fJjj3Z75xw1B/wWtBy/znYrmYLZPQg7NZKd7iBaDMepbdhhZSbDtHvsTn0idoI0rpiywdhIgX73fFO1lPdlqnBT7GAtdULoefecz1D3cPnyu19nY0aipfIO0CfPxDooSc=;
X-UUID: e07b8a8354b04b3db47f5fefc81ef96e-20200105
Received: from mtkcas07.mediatek.inc [(172.21.101.84)] by mailgw01.mediatek.com
        (envelope-from <chao.hao@mediatek.com>)
        (Cellopoint E-mail Firewall v4.1.10 Build 0809 with TLS)
        with ESMTP id 304849129; Sun, 05 Jan 2020 18:47:14 +0800
Received: from MTKCAS06.mediatek.inc (172.21.101.30) by
 mtkmbs07n1.mediatek.inc (172.21.101.16) with Microsoft SMTP Server (TLS) id
 15.0.1395.4; Sun, 5 Jan 2020 18:46:49 +0800
Received: from localhost.localdomain (10.15.20.246) by MTKCAS06.mediatek.inc
 (172.21.101.73) with Microsoft SMTP Server id 15.0.1395.4 via Frontend
 Transport; Sun, 5 Jan 2020 18:45:45 +0800
From:   Chao Hao <chao.hao@mediatek.com>
To:     Joerg Roedel <joro@8bytes.org>, Rob Herring <robh+dt@kernel.org>,
        Matthias Brugger <matthias.bgg@gmail.com>
CC:     <iommu@lists.linux-foundation.org>, <devicetree@vger.kernel.org>,
        <linux-kernel@vger.kernel.org>,
        <linux-arm-kernel@lists.infradead.org>,
        <linux-mediatek@lists.infradead.org>, <wsd_upstream@mediatek.com>,
        Chao Hao <chao.hao@mediatek.com>,
        Jun Yan <jun.yan@mediatek.com>,
        Cui Zhang <zhang.cui@mediatek.com>,
        Yong Wu <yong.wu@mediatek.com>,
        Anan Sun <anan.sun@mediatek.com>
Subject: [PATCH v2 16/19] iommu/mediatek: Remove mtk_iommu_get_m4u_data api
Date:   Sun, 5 Jan 2020 18:45:20 +0800
Message-ID: <20200105104523.31006-17-chao.hao@mediatek.com>
X-Mailer: git-send-email 2.18.0
In-Reply-To: <20200105104523.31006-1-chao.hao@mediatek.com>
References: <20200105104523.31006-1-chao.hao@mediatek.com>
MIME-Version: 1.0
Content-Type: text/plain
X-MTK:  N
Content-Transfer-Encoding: base64
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

QmFzZWQgb24gcHJldmlvdXMgbW9kaWZpY2F0aW9ucyBpbiB0aGUgcGF0Y2hzZXQsIEEgbXRrX2lv
bW11X2RhdGENCnN0cnVjdHVyZSByZXByZXNlbnQgYSBpb21tdSwgd2Ugd2lsbCBhZGQgbXRrX2lv
bW11X2RhdGEgdG8gbXRrX2lvbW11X2RvbWFpbg0KdG8gc2hvdyB0aGUgaW9tbXUgd2hpY2ggbXRr
X2lvbW11X2RvbWFpbiBiZWxvbmdzIHRvLCBzbyB3ZSBjYW4gZ2V0DQptdGtfaW9tbXVfZGF0YSBi
eSBtdGtfaW9tbXVfZG9tYWluLCBkb24ndCB1c2UgdG8gIm10a19pb21tdV9nZXRfbTR1X2RhdGEi
DQphbnkgbW9yZS4NCg0KQmVzaWRlcywgdGhlcmUgaXMgYSBzbWFsbCBTVyBhZGp1c3RtZW50LCB3
ZSB3aWxsIG1vdmUgYWxsb2MgaW9tbXVfZ3JvdXANCmludG8gImNyZWF0ZV9pb21tdV9ncm91cCIN
Cg0KU2lnbmVkLW9mZi1ieTogQ2hhbyBIYW8gPGNoYW8uaGFvQG1lZGlhdGVrLmNvbT4NCi0tLQ0K
IGRyaXZlcnMvaW9tbXUvbXRrX2lvbW11LmMgfCA3NCArKysrKysrKysrKysrKysrKysrLS0tLS0t
LS0tLS0tLS0tLS0tLS0NCiAxIGZpbGUgY2hhbmdlZCwgMzcgaW5zZXJ0aW9ucygrKSwgMzcgZGVs
ZXRpb25zKC0pDQoNCmRpZmYgLS1naXQgYS9kcml2ZXJzL2lvbW11L210a19pb21tdS5jIGIvZHJp
dmVycy9pb21tdS9tdGtfaW9tbXUuYw0KaW5kZXggYmZiMTgzMWFmYWU5Li45YTdmMmEzODhlM2Ug
MTAwNjQ0DQotLS0gYS9kcml2ZXJzL2lvbW11L210a19pb21tdS5jDQorKysgYi9kcml2ZXJzL2lv
bW11L210a19pb21tdS5jDQpAQCAtMTE1LDYgKzExNSw3IEBAIHN0cnVjdCBtdGtfaW9tbXVfZG9t
YWluIHsNCiAJdTMyCQkJCWlkOw0KIAlzdHJ1Y3QgaW9tbXVfZG9tYWluCQlkb21haW47DQogCXN0
cnVjdCBpb21tdV9ncm91cAkJKmdyb3VwOw0KKwlzdHJ1Y3QgbXRrX2lvbW11X2RhdGEJCSpkYXRh
Ow0KIAlzdHJ1Y3QgbGlzdF9oZWFkCQlsaXN0Ow0KIH07DQogDQpAQCAtMTYyLDIzICsxNjMsNiBA
QCBzdGF0aWMgTElTVF9IRUFEKG00dWxpc3QpOwkvKiBMaXN0IGFsbCB0aGUgTTRVIEhXcyAqLw0K
IA0KICNkZWZpbmUgZm9yX2VhY2hfbTR1KGRhdGEpCWxpc3RfZm9yX2VhY2hfZW50cnkoZGF0YSwg
Jm00dWxpc3QsIGxpc3QpDQogDQotLyoNCi0gKiBUaGVyZSBtYXkgYmUgMSBvciAyIE00VSBIV3Ms
IEJ1dCB3ZSBhbHdheXMgZXhwZWN0IHRoZXkgYXJlIGluIHRoZSBzYW1lIGRvbWFpbg0KLSAqIGZv
ciB0aGUgcGVyZm9ybWFuY2UuDQotICoNCi0gKiBIZXJlIGFsd2F5cyByZXR1cm4gdGhlIG10a19p
b21tdV9kYXRhIG9mIHRoZSBmaXJzdCBwcm9iZWQgTTRVIHdoZXJlIHRoZQ0KLSAqIGlvbW11IGRv
bWFpbiBpbmZvcm1hdGlvbiBpcyByZWNvcmRlZC4NCi0gKi8NCi1zdGF0aWMgc3RydWN0IG10a19p
b21tdV9kYXRhICptdGtfaW9tbXVfZ2V0X200dV9kYXRhKHZvaWQpDQotew0KLQlzdHJ1Y3QgbXRr
X2lvbW11X2RhdGEgKmRhdGE7DQotDQotCWZvcl9lYWNoX200dShkYXRhKQ0KLQkJcmV0dXJuIGRh
dGE7DQotDQotCXJldHVybiBOVUxMOw0KLX0NCi0NCiBzdGF0aWMgdTMyIGdldF9kb21haW5faWQo
c3RydWN0IG10a19pb21tdV9kYXRhICpkYXRhLCB1MzIgcG9ydGlkKQ0KIHsNCiAJdTMyIGRvbV9p
ZCA9IDA7DQpAQCAtMzk3LDYgKzM4MSwyNyBAQCBzdGF0aWMgdm9pZCBtdGtfaW9tbXVfY29uZmln
KHN0cnVjdCBtdGtfaW9tbXVfZGF0YSAqZGF0YSwNCiAJfQ0KIH0NCiANCitzdGF0aWMgc3RydWN0
IGlvbW11X2dyb3VwICpjcmVhdGVfaW9tbXVfZ3JvdXAoc3RydWN0IG10a19pb21tdV9kYXRhICpk
YXRhLA0KKwkJCQkJICAgICAgc3RydWN0IGRldmljZSAqZGV2KQ0KK3sNCisJc3RydWN0IG10a19p
b21tdV9wZ3RhYmxlICpwZ3RhYmxlID0gbXRrX2lvbW11X2dldF9wZ3RhYmxlKCk7DQorDQorCS8q
IFByZXBhcmUgZm9yIGFsbG9jYXRlIG10a19pb21tdV9kb21haW4gKi8NCisJZGF0YS0+bTR1X2dy
b3VwID0gbXRrX2lvbW11X2dldF9ncm91cChkZXYpOw0KKwlpZiAoIWRhdGEtPm00dV9ncm91cCkg
ew0KKwkJZGF0YS0+bTR1X2dyb3VwID0gaW9tbXVfZ3JvdXBfYWxsb2MoKTsNCisJCWlmIChJU19F
UlIoZGF0YS0+bTR1X2dyb3VwKSkNCisJCQlkZXZfZXJyKGRldiwgIkZhaWxlZCB0byBhbGxvY2F0
ZSBNNFUgSU9NTVUgZ3JvdXBcbiIpOw0KKwl9IGVsc2Ugew0KKwkJaW9tbXVfZ3JvdXBfcmVmX2dl
dChkYXRhLT5tNHVfZ3JvdXApOw0KKwl9DQorDQorCS8qIHNhdmUgdGhlIGxhdGVzdCBpbml0IGRl
dmljZSAqLw0KKwlwZ3RhYmxlLT5pbml0X2RldiA9IGRldjsNCisNCisJcmV0dXJuIGRhdGEtPm00
dV9ncm91cDsNCit9DQorDQogc3RhdGljIHN0cnVjdCBtdGtfaW9tbXVfcGd0YWJsZSAqY3JlYXRl
X3BndGFibGUoc3RydWN0IG10a19pb21tdV9kYXRhICpkYXRhKQ0KIHsNCiAJc3RydWN0IG10a19p
b21tdV9wZ3RhYmxlICpwZ3RhYmxlOw0KQEAgLTQ2Miw3ICs0NjcsNyBAQCBzdGF0aWMgaW50IG10
a19pb21tdV9hdHRhY2hfcGd0YWJsZShzdHJ1Y3QgbXRrX2lvbW11X2RhdGEgKmRhdGEsDQogc3Rh
dGljIHN0cnVjdCBpb21tdV9kb21haW4gKm10a19pb21tdV9kb21haW5fYWxsb2ModW5zaWduZWQg
dHlwZSkNCiB7DQogCXN0cnVjdCBtdGtfaW9tbXVfcGd0YWJsZSAqcGd0YWJsZSA9IG10a19pb21t
dV9nZXRfcGd0YWJsZSgpOw0KLQlzdHJ1Y3QgbXRrX2lvbW11X2RhdGEgKmRhdGEgPSBtdGtfaW9t
bXVfZ2V0X200dV9kYXRhKCk7DQorCXN0cnVjdCBtdGtfaW9tbXVfZGF0YSAqZGF0YTsNCiAJc3Ry
dWN0IG10a19pb21tdV9kb21haW4gKmRvbTsNCiAJc3RydWN0IGRldmljZSAqZGV2Ow0KIA0KQEAg
LTQ3MSw2ICs0NzYsNyBAQCBzdGF0aWMgc3RydWN0IGlvbW11X2RvbWFpbiAqbXRrX2lvbW11X2Rv
bWFpbl9hbGxvYyh1bnNpZ25lZCB0eXBlKQ0KIA0KIAlpZiAocGd0YWJsZSkgew0KIAkJZGV2ID0g
cGd0YWJsZS0+aW5pdF9kZXY7DQorCQlkYXRhID0gZGV2X2lvbW11X2Z3c3BlY19nZXQoZGV2KS0+
aW9tbXVfcHJpdjsNCiAJCWlmICghZGF0YS0+bTR1X2dyb3VwKSB7DQogCQkJcHJfZXJyKCIlcywg
ZmluZCBtNHVfZ3JvdXAgZmFpbGVkXG4iLCBfX2Z1bmNfXyk7DQogCQkJcmV0dXJuIE5VTEw7DQpA
QCAtNDkxLDYgKzQ5Nyw3IEBAIHN0YXRpYyBzdHJ1Y3QgaW9tbXVfZG9tYWluICptdGtfaW9tbXVf
ZG9tYWluX2FsbG9jKHVuc2lnbmVkIHR5cGUpDQogCWlmIChkb20tPmlkID49IGRhdGEtPnBsYXRf
ZGF0YS0+ZG9tX2NudCkNCiAJCWdvdG8gIHB1dF9kbWFfY29va2llOw0KIA0KKwlkb20tPmRhdGEg
PSBkYXRhOw0KIAlkb20tPmdyb3VwID0gZGF0YS0+bTR1X2dyb3VwOw0KIAkvKiBVcGRhdGUgb3Vy
IHN1cHBvcnQgcGFnZSBzaXplcyBiaXRtYXAgKi8NCiAJZG9tLT5kb21haW4ucGdzaXplX2JpdG1h
cCA9IHBndGFibGUtPmNmZy5wZ3NpemVfYml0bWFwOw0KQEAgLTU0OCw3ICs1NTUsOCBAQCBzdGF0
aWMgaW50IG10a19pb21tdV9tYXAoc3RydWN0IGlvbW11X2RvbWFpbiAqZG9tYWluLCB1bnNpZ25l
ZCBsb25nIGlvdmEsDQogCQkJIHBoeXNfYWRkcl90IHBhZGRyLCBzaXplX3Qgc2l6ZSwgaW50IHBy
b3QsIGdmcF90IGdmcCkNCiB7DQogCXN0cnVjdCBtdGtfaW9tbXVfcGd0YWJsZSAqcGd0YWJsZSA9
IG10a19pb21tdV9nZXRfcGd0YWJsZSgpOw0KLQlzdHJ1Y3QgbXRrX2lvbW11X2RhdGEgKmRhdGEg
PSBtdGtfaW9tbXVfZ2V0X200dV9kYXRhKCk7DQorCXN0cnVjdCBtdGtfaW9tbXVfZG9tYWluICpk
b20gPSB0b19tdGtfZG9tYWluKGRvbWFpbik7DQorCXN0cnVjdCBtdGtfaW9tbXVfZGF0YSAqZGF0
YSA9IGRvbS0+ZGF0YTsNCiANCiAJLyogVGhlICI0R0IgbW9kZSIgTTRVIHBoeXNpY2FsbHkgY2Fu
IG5vdCB1c2UgdGhlIGxvd2VyIHJlbWFwIG9mIERyYW0uICovDQogCWlmIChkYXRhLT5lbmFibGVf
NEdCKQ0KQEAgLTU2OSwyNyArNTc3LDMwIEBAIHN0YXRpYyBzaXplX3QgbXRrX2lvbW11X3VubWFw
KHN0cnVjdCBpb21tdV9kb21haW4gKmRvbWFpbiwNCiANCiBzdGF0aWMgdm9pZCBtdGtfaW9tbXVf
Zmx1c2hfaW90bGJfYWxsKHN0cnVjdCBpb21tdV9kb21haW4gKmRvbWFpbikNCiB7DQotCW10a19p
b21tdV90bGJfZmx1c2hfYWxsKG10a19pb21tdV9nZXRfbTR1X2RhdGEoKSk7DQorCXN0cnVjdCBt
dGtfaW9tbXVfZG9tYWluICpkb20gPSB0b19tdGtfZG9tYWluKGRvbWFpbik7DQorDQorCW10a19p
b21tdV90bGJfZmx1c2hfYWxsKGRvbS0+ZGF0YSk7DQogfQ0KIA0KIHN0YXRpYyB2b2lkIG10a19p
b21tdV9pb3RsYl9zeW5jKHN0cnVjdCBpb21tdV9kb21haW4gKmRvbWFpbiwNCiAJCQkJIHN0cnVj
dCBpb21tdV9pb3RsYl9nYXRoZXIgKmdhdGhlcikNCiB7DQotCXN0cnVjdCBtdGtfaW9tbXVfZGF0
YSAqZGF0YSA9IG10a19pb21tdV9nZXRfbTR1X2RhdGEoKTsNCisJc3RydWN0IG10a19pb21tdV9k
b21haW4gKmRvbSA9IHRvX210a19kb21haW4oZG9tYWluKTsNCiAJc2l6ZV90IGxlbmd0aCA9IGdh
dGhlci0+ZW5kIC0gZ2F0aGVyLT5zdGFydDsNCiANCiAJaWYgKGdhdGhlci0+c3RhcnQgPT0gVUxP
TkdfTUFYKQ0KIAkJcmV0dXJuOw0KIA0KIAltdGtfaW9tbXVfdGxiX2ZsdXNoX3JhbmdlX3N5bmMo
Z2F0aGVyLT5zdGFydCwgbGVuZ3RoLCBnYXRoZXItPnBnc2l6ZSwNCi0JCQkJICAgICAgIGRhdGEp
Ow0KKwkJCQkgICAgICAgZG9tLT5kYXRhKTsNCiB9DQogDQogc3RhdGljIHBoeXNfYWRkcl90IG10
a19pb21tdV9pb3ZhX3RvX3BoeXMoc3RydWN0IGlvbW11X2RvbWFpbiAqZG9tYWluLA0KIAkJCQkJ
ICBkbWFfYWRkcl90IGlvdmEpDQogew0KIAlzdHJ1Y3QgbXRrX2lvbW11X3BndGFibGUgKnBndGFi
bGUgPSBtdGtfaW9tbXVfZ2V0X3BndGFibGUoKTsNCi0Jc3RydWN0IG10a19pb21tdV9kYXRhICpk
YXRhID0gbXRrX2lvbW11X2dldF9tNHVfZGF0YSgpOw0KKwlzdHJ1Y3QgbXRrX2lvbW11X2RvbWFp
biAqZG9tID0gdG9fbXRrX2RvbWFpbihkb21haW4pOw0KKwlzdHJ1Y3QgbXRrX2lvbW11X2RhdGEg
KmRhdGEgPSBkb20tPmRhdGE7DQogCXBoeXNfYWRkcl90IHBhOw0KIA0KIAlwYSA9IHBndGFibGUt
PmlvcC0+aW92YV90b19waHlzKHBndGFibGUtPmlvcCwgaW92YSk7DQpAQCAtNjM2LDcgKzY0Nyw3
IEBAIHN0YXRpYyB2b2lkIG10a19pb21tdV9yZW1vdmVfZGV2aWNlKHN0cnVjdCBkZXZpY2UgKmRl
dikNCiANCiBzdGF0aWMgc3RydWN0IGlvbW11X2dyb3VwICptdGtfaW9tbXVfZGV2aWNlX2dyb3Vw
KHN0cnVjdCBkZXZpY2UgKmRldikNCiB7DQotCXN0cnVjdCBtdGtfaW9tbXVfZGF0YSAqZGF0YSA9
IG10a19pb21tdV9nZXRfbTR1X2RhdGEoKTsNCisJc3RydWN0IG10a19pb21tdV9kYXRhICpkYXRh
ID0gZGV2LT5pb21tdV9md3NwZWMtPmlvbW11X3ByaXY7DQogCXN0cnVjdCBtdGtfaW9tbXVfcGd0
YWJsZSAqcGd0YWJsZTsNCiAJaW50IHJldCA9IDA7DQogDQpAQCAtNjUyLDIwICs2NjMsOSBAQCBz
dGF0aWMgc3RydWN0IGlvbW11X2dyb3VwICptdGtfaW9tbXVfZGV2aWNlX2dyb3VwKHN0cnVjdCBk
ZXZpY2UgKmRldikNCiAJCX0NCiAJfQ0KIA0KLQkvKiBBbGwgdGhlIGNsaWVudCBkZXZpY2VzIGFy
ZSBpbiB0aGUgc2FtZSBtNHUgaW9tbXUtZ3JvdXAgKi8NCi0JZGF0YS0+bTR1X2dyb3VwID0gbXRr
X2lvbW11X2dldF9ncm91cChkZXYpOw0KLQlpZiAoIWRhdGEtPm00dV9ncm91cCkgew0KLQkJZGF0
YS0+bTR1X2dyb3VwID0gaW9tbXVfZ3JvdXBfYWxsb2MoKTsNCi0JCWlmIChJU19FUlIoZGF0YS0+
bTR1X2dyb3VwKSkNCi0JCQlkZXZfZXJyKGRldiwgIkZhaWxlZCB0byBhbGxvY2F0ZSBNNFUgSU9N
TVUgZ3JvdXBcbiIpOw0KLQl9IGVsc2Ugew0KLQkJaW9tbXVfZ3JvdXBfcmVmX2dldChkYXRhLT5t
NHVfZ3JvdXApOw0KLQl9DQorCWRldl9pbmZvKGRhdGEtPmRldiwgIiVzLCBpbml0IGRhdGE6JWRc
biIsIF9fZnVuY19fLCBkYXRhLT5tNHVfaWQpOw0KIA0KLQkvKiBzYXZlIHRoZSBsYXRlc3QgaW5p
dCBkZXZpY2UgKi8NCi0JcGd0YWJsZS0+aW5pdF9kZXYgPSBkZXY7DQotDQotCXJldHVybiBkYXRh
LT5tNHVfZ3JvdXA7DQorCXJldHVybiBjcmVhdGVfaW9tbXVfZ3JvdXAoZGF0YSwgZGV2KTsNCiB9
DQogDQogc3RhdGljIGludCBtdGtfaW9tbXVfb2ZfeGxhdGUoc3RydWN0IGRldmljZSAqZGV2LCBz
dHJ1Y3Qgb2ZfcGhhbmRsZV9hcmdzICphcmdzKQ0KLS0gDQoyLjE4LjANCg==

