Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id E3E33195589
	for <lists+linux-kernel@lfdr.de>; Fri, 27 Mar 2020 11:45:00 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1727125AbgC0Ko6 (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Fri, 27 Mar 2020 06:44:58 -0400
Received: from mail.skyhub.de ([5.9.137.197]:38290 "EHLO mail.skyhub.de"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1726333AbgC0Ko5 (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
        Fri, 27 Mar 2020 06:44:57 -0400
Received: from zn.tnic (p200300EC2F0CFA00088B6946FACBDF73.dip0.t-ipconnect.de [IPv6:2003:ec:2f0c:fa00:88b:6946:facb:df73])
        (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
        (No client certificate requested)
        by mail.skyhub.de (SuperMail on ZX Spectrum 128k) with ESMTPSA id 1194F1EC0B55;
        Fri, 27 Mar 2020 11:44:55 +0100 (CET)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=alien8.de; s=dkim;
        t=1585305895;
        h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
         to:to:cc:cc:mime-version:mime-version:content-type:content-type:
         content-transfer-encoding:in-reply-to:in-reply-to:  references:references;
        bh=36XQm7d4lMVCZuRlrLozamodSN2VpWOmzGzo6pyRJKE=;
        b=Tt4Slj01uST/5gy1rV78Uf0LbXrcpwnjNLrR6hesYZEwbLI/5lIgFAVRMJZIpMfYXOeJeL
        2REanSZL6unXq+fB/wvNAeTdxf2xHakJpcLsocTdRqdjOSpF5oWHY1tUhSEm/F58ajID+d
        yHYHUvLu2Art8dYwjS6LZv1/CnRGKiM=
Date:   Fri, 27 Mar 2020 11:44:50 +0100
From:   Borislav Petkov <bp@alien8.de>
To:     "H.J. Lu" <hjl.tools@gmail.com>
Cc:     linux-kernel@vger.kernel.org, Andy Lutomirski <luto@kernel.org>,
        Thomas Gleixner <tglx@linutronix.de>,
        Kees Cook <keescook@chromium.org>,
        Ingo Molnar <mingo@redhat.com>,
        "H . Peter Anvin" <hpa@zytor.com>, x86@kernel.org,
        Yu-cheng Yu <yu-cheng.yu@intel.com>
Subject: Re: [PATCH] x86: Discard .note.gnu.property sections in vDSO
Message-ID: <20200327104450.GA8015@zn.tnic>
References: <20200326174314.254662-1-hjl.tools@gmail.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Disposition: inline
In-Reply-To: <20200326174314.254662-1-hjl.tools@gmail.com>
User-Agent: Mutt/1.10.1 (2018-07-13)
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Thu, Mar 26, 2020 at 10:43:14AM -0700, H.J. Lu wrote:
> With the command-line option, -mx86-used-note=yes, the x86 assembler

I see:

       -mx86-used-note=no
       -mx86-used-note=yes
           These options control whether the assembler should generate
           GNU_PROPERTY_X86_ISA_1_USED and GNU_PROPERTY_X86_FEATURE_2_USED GNU property
           notes.  The default can be controlled by the --enable-x86-used-note
           configure option.

Is there a plan to use this build option in the kernel in the future or
all binutils will have it enabled or what's the story here?

Because I don't see -mx86-used-note used anywhere in the kernel...

> in binutils 2.32 and above generates a program property note in a note
> section, .note.gnu.property, to encode used x86 ISAs and features.  But
> x86 kernel vDSO linker script only contains a single NOTE segment:
> 
> PHDRS
> {
>  text PT_LOAD FLAGS(5) FILEHDR PHDRS; /* PF_R|PF_X */
>  dynamic PT_DYNAMIC FLAGS(4); /* PF_R */
>  note PT_NOTE FLAGS(4); /* PF_R */
>  eh_frame_hdr 0x6474e550;
> }
> 
> The NOTE segment generated by vDSO linker script is aligned to 4 bytes.
> But .note.gnu.property section must be aligned to 8 bytes on x86-64 and
> we get
> 
> [hjl@gnu-skx-1 vdso]$ readelf -n vdso64.so
> 
> Displaying notes found in: .note
>   Owner                Data size 	Description
>   Linux                0x00000004	Unknown note type: (0x00000000)
>    description data: 06 00 00 00
> readelf: Warning: note with invalid namesz and/or descsz found at offset 0x20
> readelf: Warning:  type: 0x78, namesize: 0x00000100, descsize: 0x756e694c, alignment: 8
> [hjl@gnu-skx-1 vdso]$
> 
> Since note.gnu.property section in vDSO is not checked by dynamic linker,
> this patch discards .note.gnu.property sections in vDSO by adding

Avoid having "This patch" or "This commit" in the commit message. It is
tautologically useless.

Also, do

$ git grep 'This patch' Documentation/process

for more details.

-- 
Regards/Gruss,
    Boris.

https://people.kernel.org/tglx/notes-about-netiquette
