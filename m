Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Original-To: lists+linux-kernel@lfdr.de
Delivered-To: lists+linux-kernel@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id 2DEE6AD5E3
	for <lists+linux-kernel@lfdr.de>; Mon,  9 Sep 2019 11:40:55 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2388163AbfIIJkv (ORCPT <rfc822;lists+linux-kernel@lfdr.de>);
        Mon, 9 Sep 2019 05:40:51 -0400
Received: from foss.arm.com ([217.140.110.172]:46696 "EHLO foss.arm.com"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1725818AbfIIJkv (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
        Mon, 9 Sep 2019 05:40:51 -0400
Received: from usa-sjc-imap-foss1.foss.arm.com (unknown [10.121.207.14])
        by usa-sjc-mx-foss1.foss.arm.com (Postfix) with ESMTP id 50ADA1000;
        Mon,  9 Sep 2019 02:40:50 -0700 (PDT)
Received: from big-swifty.misterjones.org (unknown [172.31.20.19])
        by usa-sjc-imap-foss1.foss.arm.com (Postfix) with ESMTPSA id 9EC1B3F71F;
        Mon,  9 Sep 2019 02:40:47 -0700 (PDT)
Date:   Mon, 09 Sep 2019 10:40:45 +0100
Message-ID: <86d0g9st7m.wl-maz@kernel.org>
From:   Marc Zyngier <maz@kernel.org>
To:     Talel Shenhar <talel@amazon.com>
Cc:     <tglx@linutronix.de>, <jason@lakedaemon.net>,
        <linux-kernel@vger.kernel.org>, <dwmw@amazon.co.uk>,
        <benh@kernel.crashing.org>, <hhhawa@amazon.com>,
        <ronenk@amazon.com>, <jonnyc@amazon.com>, <hanochu@amazon.com>,
        <barakw@amazon.com>
Subject: Re: [PATCH 1/1] irqchip: al-fic: add support for irq retrigger
In-Reply-To: <1568018358-18985-1-git-send-email-talel@amazon.com>
References: <1568018358-18985-1-git-send-email-talel@amazon.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 EasyPG/1.0.0 Emacs/26
 (aarch64-unknown-linux-gnu) MULE/6.0 (HANACHIRUSATO)
Organization: Approximate
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Mon, 09 Sep 2019 09:39:18 +0100,
Talel Shenhar <talel@amazon.com> wrote:

Hi Talel,

> 
> Introduce interrupts retrigger support for Amazon's Annapurna Labs Fabric
> Interrupt Controller.
> 
> Signed-off-by: Talel Shenhar <talel@amazon.com>
> ---
>  drivers/irqchip/irq-al-fic.c | 12 ++++++++++++
>  1 file changed, 12 insertions(+)
> 
> diff --git a/drivers/irqchip/irq-al-fic.c b/drivers/irqchip/irq-al-fic.c
> index 1a57cee..0b0a737 100644
> --- a/drivers/irqchip/irq-al-fic.c
> +++ b/drivers/irqchip/irq-al-fic.c
> @@ -15,6 +15,7 @@
>  
>  /* FIC Registers */
>  #define AL_FIC_CAUSE		0x00
> +#define AL_FIC_SET_CAUSE	0x08
>  #define AL_FIC_MASK		0x10
>  #define AL_FIC_CONTROL		0x28
>  
> @@ -126,6 +127,16 @@ static void al_fic_irq_handler(struct irq_desc *desc)
>  	chained_irq_exit(irqchip, desc);
>  }
>  
> +static int al_fic_irq_retrigger(struct irq_data *data)
> +{
> +	struct irq_chip_generic *gc = irq_data_get_irq_chip_data(data);
> +	struct al_fic *fic = gc->private;
> +
> +	writel_relaxed(BIT(data->hwirq), fic->base + AL_FIC_SET_CAUSE);
> +
> +	return 1;
> +}
> +
>  static int al_fic_register(struct device_node *node,
>  			   struct al_fic *fic)
>  {
> @@ -159,6 +170,7 @@ static int al_fic_register(struct device_node *node,
>  	gc->chip_types->chip.irq_unmask = irq_gc_mask_clr_bit;
>  	gc->chip_types->chip.irq_ack = irq_gc_ack_clr_bit;
>  	gc->chip_types->chip.irq_set_type = al_fic_irq_set_type;
> +	gc->chip_types->chip.irq_retrigger = al_fic_irq_retrigger;
>  	gc->chip_types->chip.flags = IRQCHIP_SKIP_SET_WAKE;
>  	gc->private = fic;

Looks good to me. Is this a fix or a new feature? If the former, I can
queue it up for -rc1.

	M.

-- 
Jazz is not dead, it just smells funny.
